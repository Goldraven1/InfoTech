# Техническая документация кода InfoTech

## Обзор архитектуры

Приложение InfoTech использует следующие компоненты:

1. **Backend**: Python с библиотекой Eel для создания веб-интерфейса в десктопном приложении
2. **Frontend**: HTML, CSS и JavaScript
3. **База данных**: PostgreSQL для хранения данных
4. **Конфигурация**: INI-файлы для настроек приложения
5. **Логирование**: Стандартный модуль logging Python

```
           ┌────────────────┐
           │   Web Browser  │
           │  (Интерфейс)   │
           └───────┬────────┘
                   │
                   ▼
┌──────────────────────────────────┐
│          Python + Eel            │
│   (Бэкенд, логика приложения)    │
└──────────────┬───────────────────┘
               │
               ▼
┌──────────────────────────────────┐
│          PostgreSQL              │
│       (База данных)              │
└──────────────────────────────────┘
```

## Серверная часть (Backend)

### app.py

Это основной файл приложения, который инициализирует Eel, управляет подключением к базе данных и предоставляет API для веб-интерфейса.

#### Основные компоненты:

1. **Инициализация Eel**: Настраивает директорию с веб-файлами.
2. **Настройка логирования**: Создает директорию для логов и настраивает logger.
3. **Чтение конфигурации**: Загружает параметры из `config.ini`.
4. **Подключение к БД**: Функция `connect_to_db()` для соединения с PostgreSQL.
5. **API функции**:
   - `get_data()`: Получает данные из БД и передает их в веб-интерфейс.

#### Пример использования функций:

```python
# Подключение к базе данных
conn = connect_to_db()

# Получение данных (вызывается из JavaScript через Eel)
data = get_data() 
```

### run.py

Этот файл служит точкой входа для запуска приложения.

#### Основные компоненты:

1. **Инициализация Eel**: Настраивает директорию с веб-файлами.
2. **Подключение к БД**: Создает экземпляр подключения к PostgreSQL.
3. **Настройка маршрутизации**: Инициализирует маршруты через класс `Routes`.
4. **Запуск приложения**: Метод `eel.start()` для запуска веб-интерфейса.

### config.ini

Файл конфигурации, содержащий настройки приложения.

#### Секции:

1. **Database**: Параметры подключения к PostgreSQL (host, port, database, user, password).
2. **Application**: Общие настройки приложения (debug, port).

## Клиентская часть (Frontend)

### index.html

Основной HTML-файл, определяющий структуру пользовательского интерфейса.

#### Основные элементы:

1. **Header**: Содержит заголовок и поисковую панель.
2. **Main**: Основная часть с панелью инструментов и контейнером данных.
3. **JavaScript**: Подключение к Eel и основного скрипта приложения.

### style.css

Стили для веб-интерфейса. Определяет внешний вид всех элементов UI.

### app.js

JavaScript-код для управления клиентской логикой и взаимодействия с сервером.

#### Основные функции:

1. **loadData()**: Загружает данные с сервера при загрузке страницы.
2. **displayData(data)**: Отображает данные в виде таблицы.
3. **editRecord(id)**: Обработчик для редактирования записи.
4. **deleteRecord(id)**: Обработчик для удаления записи.
5. **Обработчики событий**: Для кнопок добавления, экспорта, поиска.

#### Пример вызова серверной функции:

```javascript
// Вызов Python-функции через Eel
const data = await eel.get_data()();
```

## Взаимодействие компонентов

1. **Клиент-Серверное взаимодействие**:
   - JavaScript вызывает функции Python через `eel.function_name()()`
   - Python-функции помечены декоратором `@eel.expose`

2. **Работа с базой данных**:
   - Подключение происходит через `psycopg2`
   - Запросы выполняются в функциях, помеченных `@eel.expose`
   - Результаты возвращаются в JavaScript

3. **Обработка ошибок**:
   - На сервере используется логирование в файл
   - На клиенте ошибки выводятся в консоль и отображаются пользователю

## Тестирование

### test_app.py

Набор тестов для проверки функциональности приложения.

#### Основные тесты:

1. **test_connection()**: Проверка подключения к базе данных.
2. **test_data_retrieval()**: Проверка получения данных из БД.

## Расширение и доработка

### Добавление новой функциональности

1. **Добавление нового API-метода**:
   ```python
   @eel.expose
   def new_function(param):
       # Логика функции
       return result
   ```

2. **Вызов из JavaScript**:
   ```javascript
   const result = await eel.new_function(param)();
   ```

3. **Добавление нового UI-элемента**:
   - Добавить HTML разметку в `index.html`
   - Добавить стили в `style.css`
   - Добавить обработку в `app.js`

### Изменение структуры базы данных

При изменении структуры БД необходимо:
1. Обновить SQL-запросы в Python-коде
2. Обновить отображение данных в `displayData()` функции JavaScript

## Примеры основных операций

### Получение данных из БД

```python
@eel.expose
def get_specific_data(filter_param):
    try:
        conn = connect_to_db()
        if conn:
            cur = conn.cursor()
            cur.execute("SELECT * FROM users WHERE parameter = %s", (filter_param,))
            data = cur.fetchall()
            cur.close()
            conn.close()
            return data
        return []
    except Exception as e:
        logging.error(f"Ошибка при получении данных: {e}")
        return []
```

### Добавление данных в БД

```python
@eel.expose
def add_data(name, description):
    try:
        conn = connect_to_db()
        if conn:
            cur = conn.cursor()
            cur.execute("INSERT INTO users (name, description) VALUES (%s, %s) RETURNING id", 
                       (name, description))
            new_id = cur.fetchone()[0]
            conn.commit()
            cur.close()
            conn.close()
            return {"success": True, "id": new_id}
        return {"success": False, "error": "Ошибка подключения к БД"}
    except Exception as e:
        logging.error(f"Ошибка при добавлении данных: {e}")
        return {"success": False, "error": str(e)}
```
